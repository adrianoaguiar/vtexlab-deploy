// Generated by CoffeeScript 1.7.1

/*
Module dependencies.
 */

(function() {
  var app, config, express, validateHookSource;

  express = require('express');

  app = express();

  app.use(express.json());

  app.use(express.urlencoded());

  app.set("port", process.env.PORT || 3000);

  config = {
    port: process.env.PORT || 1338,
    env: process.env.NODE_ENV || 'development'
  };

  validateHookSource = function(req, res, next) {
    var repo, _ref;
    try {
      repo = JSON.parse(req.body.payload).repository;
      if ((_ref = repo.name) !== 'vtexlab' && _ref !== 'docs' && _ref !== 'guide') {
        res.send(401, "Unauthorized");
      }
    } catch (_error) {
      res.send(401, "Unauthorized");
    }
    return res.send(200, "Authorized.");
  };

  app.get('/', function(req, res) {
    return res.send("<h1>Works!</h1>");
  });

  app.post("/hooks", validateHookSource);

  http.createServer(app).listen(app.get("port"), function() {
    console.log("Express server listening on port " + app.get("port"));
  });

}).call(this);
